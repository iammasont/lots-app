/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}e.d({},{XJ:()=>Z,C_:()=>$});var c={rgb:[{x:0,y:0},{x:.25,y:.25},{x:.5,y:.5},{x:.75,y:.75},{x:1,y:1}],red:[{x:0,y:0},{x:.25,y:.25},{x:.5,y:.5},{x:.75,y:.75},{x:1,y:1}],green:[{x:0,y:0},{x:.25,y:.25},{x:.5,y:.5},{x:.75,y:.75},{x:1,y:1}],blue:[{x:0,y:0},{x:.25,y:.25},{x:.5,y:.5},{x:.75,y:.75},{x:1,y:1}],currentChannel:"rgb"};function l(e){for(var t=0;t<e.length;t++){var n=e[t].x;if(Math.abs(e[t].y-n)>.01)return!1}return!0}function s(e,t){if(t<=0)return e[0].y;if(t>=1)return e[e.length-1].y;for(var n=0;n<e.length-1&&e[n+1].x<t;)n++;var r=e[n],o=e[n+1],a=(t-r.x)/(o.x-r.x);return r.y+a*(o.y-r.y)}var u=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=r(r({},JSON.parse(JSON.stringify(c))),t),this.curveCanvas=null,this.curveCtx=null,this.channelButtons={},this.activePoint=null,this.init=this.init.bind(this),this.drawCurve=this.drawCurve.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.resetCurve=this.resetCurve.bind(this)},t=[{key:"init",value:function(){console.log("Initializing Curves Panel"),this.curveCanvas=document.getElementById("curve-canvas"),this.curveCanvas?(this.curveCtx=this.curveCanvas.getContext("2d"),this.channelButtons={rgb:document.getElementById("curve-rgb"),red:document.getElementById("curve-red"),green:document.getElementById("curve-green"),blue:document.getElementById("curve-blue")},this.setupEvents(),this.updateChannelButtonUI(),this.drawCurve()):console.warn("Curve canvas not found")}},{key:"setupEvents",value:function(){var e=this;if(this.curveCanvas){this.curveCanvas.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp);var t=function(t){var n=e.channelButtons[t];n&&n.addEventListener("click",(function(){e.params.currentChannel=t,e.updateChannelButtonUI(),e.drawCurve()}))};for(var n in this.channelButtons)t(n);var r=document.getElementById("reset-curve-btn");r&&r.addEventListener("click",this.resetCurve)}}},{key:"updateChannelButtonUI",value:function(){for(var e in this.channelButtons){var t=this.channelButtons[e];t&&(e===this.params.currentChannel?t.classList.add("active"):t.classList.remove("active"))}}},{key:"resetCurve",value:function(){console.log("Resetting curve"),this.params[this.params.currentChannel]=JSON.parse(JSON.stringify(c[this.params.currentChannel])),this.drawCurve(),$()}},{key:"drawCurve",value:function(){var e=this;if(this.curveCanvas&&this.curveCtx){var t=this.curveCanvas.width,n=this.curveCanvas.height;this.curveCtx.clearRect(0,0,t,n);var r,o=this.params[this.params.currentChannel];switch(this.curveCtx.fillStyle="rgba(20, 20, 20, 0.3)",this.curveCtx.fillRect(0,0,t,n),this.params.currentChannel){case"red":r="rgba(255, 100, 100, 0.8)";break;case"green":r="rgba(100, 255, 100, 0.8)";break;case"blue":r="rgba(100, 100, 255, 0.8)";break;default:r="rgba(255, 255, 255, 0.8)"}this.curveCtx.beginPath(),this.curveCtx.moveTo(o[0].x*t,(1-o[0].y)*n);for(var a=1;a<o.length;a++)this.curveCtx.lineTo(o[a].x*t,(1-o[a].y)*n);this.curveCtx.strokeStyle=r,this.curveCtx.lineWidth=2,this.curveCtx.stroke(),o.forEach((function(r,a){e.curveCtx.beginPath(),e.curveCtx.arc(r.x*t,(1-r.y)*n,5,0,2*Math.PI),0===a||a===o.length-1?e.curveCtx.fillStyle="rgba(150, 150, 150, 0.8)":e.curveCtx.fillStyle="rgba(255, 255, 255, 0.8)",e.curveCtx.fill(),e.curveCtx.strokeStyle="rgba(0, 0, 0, 0.8)",e.curveCtx.lineWidth=1,e.curveCtx.stroke()}))}else console.warn("Canvas not ready for drawing")}},{key:"handleMouseDown",value:function(e){if(this.curveCanvas){var t=this.curveCanvas.getBoundingClientRect(),n=(e.clientX-t.left)/t.width,r=1-(e.clientY-t.top)/t.height,o=this.params[this.params.currentChannel],a=1/0,i=null,c=-1;o.forEach((function(e,t){var o=e.x-n,l=e.y-r,s=Math.sqrt(o*o+l*l);s<a&&(a=s,i=e,c=t)})),a<.05&&c>0&&c<o.length-1&&(this.activePoint={point:i,index:c})}}},{key:"handleMouseMove",value:function(e){if(this.activePoint&&this.curveCanvas){var t=this.curveCanvas.getBoundingClientRect(),n=(e.clientX-t.left)/t.width,r=1-(e.clientY-t.top)/t.height;n=Math.max(0,Math.min(1,n)),r=Math.max(0,Math.min(1,r));var o=this.params[this.params.currentChannel],a=this.activePoint.index,i=o[a-1].x,c=o[a+1].x;n=Math.max(i+.01,Math.min(c-.01,n)),o[a].x=n,o[a].y=r,this.drawCurve(),$()}}},{key:"handleMouseUp",value:function(){this.activePoint=null}},{key:"applyCurves",value:function(e,t,n){var r=this.params.rgb;return e=s(r,e),t=s(r,t),n=s(r,n),l(this.params.red)||(e=s(this.params.red,e)),l(this.params.green)||(t=s(this.params.green,t)),l(this.params.blue)||(n=s(this.params.blue,n)),{r:e,g:t,b:n}}},{key:"applyCurvesToImage",value:function(e){for(var t=e.data,n=0;n<t.length;n+=4){var r=t[n]/255,o=t[n+1]/255,a=t[n+2]/255,i=this.applyCurves(r,o,a);t[n]=Math.round(255*i.r),t[n+1]=Math.round(255*i.g),t[n+2]=Math.round(255*i.b)}return e}}],t&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),d=null;function h(e,t){if(e){var n=t.id,r=t.label,o=t.min,a=t.max,i=t.step,c=t.initialValue,l=t.paramName;console.log("Creating advanced slider: ".concat(n," for ").concat(l));var s=document.createElement("div");s.className="control-group";var u=document.createElement("label");u.setAttribute("for",n),u.textContent=r+" ";var d=document.createElement("span");d.id="".concat(n,"-value"),d.className="parameter-value",d.textContent=c.toFixed(1),u.appendChild(d);var h=document.createElement("input");return h.type="range",h.id=n,h.min=o,h.max=a,h.step=i,h.value=c,s.appendChild(u),s.appendChild(h),e.appendChild(s),h.addEventListener("input",(function(){Z.currentLutParams.lumetri||(Z.currentLutParams.lumetri={}),Z.currentLutParams.lumetri[l]=parseFloat(h.value),d.textContent=parseFloat(h.value).toFixed(1),console.log("Advanced parameter updated: ".concat(l," = ").concat(h.value)),$()})),{slider:h,valueDisplay:d}}console.error("Cannot create slider: container is null")}function g(){console.log("Resetting advanced controls to defaults"),Z.currentLutParams.lumetri={exposure:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,temperature:0,tint:0},document.querySelectorAll('#basic-correction-section input[type="range"]').forEach((function(e){var t=e.id.split("-")[0];e.value=Z.currentLutParams.lumetri[t]||0;var n=document.getElementById("".concat(e.id,"-value"));n&&(n.textContent="0.0")})),$()}function m(e,t,n){e&&t?(e.value=Z.currentLutParams.basic[n],t.textContent=Z.currentLutParams.basic[n].toFixed(2),e.addEventListener("input",(function(){Z.currentLutParams.basic[n]=parseFloat(e.value),t.textContent=Z.currentLutParams.basic[n].toFixed(2),console.log("Basic parameter updated: ".concat(n," = ").concat(e.value)),$()}))):console.warn("Cannot set up slider: ".concat(n," - missing elements"))}function f(e){for(var t=Z.currentLutParams.basic,n=e.data,r=0;r<n.length;r+=4){var o=n[r]/255,a=n[r+1]/255,i=n[r+2]/255;if(o=v(o,t.contrast),a=v(a,t.contrast),i=v(i,t.contrast),o*=t.redBalance,a*=t.greenBalance,i*=t.blueBalance,1!==t.saturation){var c=.2126*o+.7152*a+.0722*i;o=c+t.saturation*(o-c),a=c+t.saturation*(a-c),i=c+t.saturation*(i-c)}if(t.shadowsShift&&t.highlightsShift){var l=Math.pow(1-Math.max(o,Math.max(a,i)),2),s=Math.pow(Math.max(o,Math.max(a,i)),2);o+=t.shadowsShift[0]*l+t.highlightsShift[0]*s,a+=t.shadowsShift[1]*l+t.highlightsShift[1]*s,i+=t.shadowsShift[2]*l+t.highlightsShift[2]*s}o=Math.min(1,Math.max(0,o)),a=Math.min(1,Math.max(0,a)),i=Math.min(1,Math.max(0,i)),n[r]=Math.round(255*o),n[r+1]=Math.round(255*a),n[r+2]=Math.round(255*i)}return e}function v(e,t){return.5+(e-.5)*t}function p(e,t,n){e&&t&&(e.value=Z.currentLutParams.creative[n],t.textContent=Z.currentLutParams.creative[n].toFixed(1),e.addEventListener("input",(function(){Z.currentLutParams.creative[n]=parseFloat(e.value),t.textContent=Z.currentLutParams.creative[n].toFixed(1),$()})))}function y(e,t,n,r){var o=.2126*e+.7152*t+.0722*n,a=Math.max(e,t,n),i=Math.min(e,t,n),c=r*(1-(0===a?0:(a-i)/a));return{r:e=o+(e-o)*(1+c),g:t=o+(t-o)*(1+c),b:n=o+(n-o)*(1+c)}}function b(e,t,n,r){var o=.5*r;e=e*(1-o)+.5*o,t=t*(1-o)+.5*o,n=n*(1-o)+.5*o;var a=.1*r;return{r:e+=a,g:t+=a,b:n+=a}}function w(e,t){if(e){e.innerHTML="";var n=document.createElement("canvas");n.width=e.clientWidth||80,n.height=e.clientHeight||80,e.appendChild(n),e.style.background="conic-gradient(red, yellow, lime, cyan, blue, magenta, red)",e.style.backgroundImage="radial-gradient(circle at center, white 0%, rgba(255, 255, 255, 0) 70%), conic-gradient(red, yellow, lime, cyan, blue, magenta, red)";var r=document.createElement("div");r.className="wheel-indicator",e.appendChild(r);var o=Z.currentLutParams.colorWheels[t],a=e.clientWidth/2,i=e.clientHeight/2,c=Math.min(a,i)-2,l=(o.r-128)/128,s=(o.g-128)/128,u=(o.b-128)/128,d=Math.sqrt(l*l+s*s+u*u),h=0;(d=Math.min(1,d))>0&&(h=Math.atan2(s,l),u>Math.max(l,s)&&(h=Math.PI+Math.atan2(u,-l)),h<0&&(h+=2*Math.PI));var g=Math.cos(h)*d*c,m=Math.sin(h)*d*c;L(e,r,g,m);var f=!1;e.addEventListener("mousedown",(function(e){f=!0,v(e)})),document.addEventListener("mousemove",(function(e){f&&v(e)})),document.addEventListener("mouseup",(function(){f=!1})),e.addEventListener("click",v)}function v(n){var o=e.getBoundingClientRect(),a=o.width/2,i=o.height/2,c=n.clientX-o.left-a,l=n.clientY-o.top-i,s=Math.sqrt(c*c+l*l),u=Math.min(a,i)-2;if(s<=u){L(e,r,c,l);var d=Math.atan2(l,c);d<0&&(d+=2*Math.PI);var h=s/u,g=function(e,t){var n,r,o,a=Math.floor(6*e),i=6*e-a,c=1*(1-t),l=1*(1-i*t),s=1*(1-(1-i)*t);switch(a%6){case 0:n=1,r=s,o=c;break;case 1:n=l,r=1,o=c;break;case 2:n=c,r=1,o=s;break;case 3:n=c,r=l,o=1;break;case 4:n=s,r=c,o=1;break;case 5:n=1,r=c,o=l}return{r:Math.round(255*n),g:Math.round(255*r),b:Math.round(255*o)}}(d/(2*Math.PI),h),m=Math.round(128+(g.r-128)*h),f=Math.round(128+(g.g-128)*h),v=Math.round(128+(g.b-128)*h);Z.currentLutParams.colorWheels[t]={r:m,g:f,b:v},$()}}}function x(){Z.currentLutParams.colorWheels.shadowTint={r:128,g:128,b:128},Z.currentLutParams.colorWheels.highlightTint={r:128,g:128,b:128},Z.currentLutParams.colorWheels.tintBalance=0;var e=document.getElementById("tint-balance"),t=document.getElementById("tint-balance-value");e&&(e.value=0),t&&(t.textContent="0.0");var n=document.getElementById("shadow-color-wheel"),r=document.getElementById("highlight-color-wheel");if(n){var o=n.querySelector(".wheel-indicator");o&&L(n,o,0,0)}if(r){var a=r.querySelector(".wheel-indicator");a&&L(r,a,0,0)}$()}function L(e,t,n,r){var o=e.clientWidth/2,a=e.clientHeight/2;t.style.left="".concat(o+n,"px"),t.style.top="".concat(a+r,"px")}function E(e,t,n,r,o,a){var i=.2126*e+.7152*t+.0722*n,c=Math.pow(1-i,2),l=Math.pow(i,2);return a>0?(c*=1-a,l=l*(1-a)+a):a<0&&(l*=1+a,c=c*(1+a)-a),e+=(r.r-128)/128*c*.5,t+=(r.g-128)/128*c*.5,n+=(r.b-128)/128*c*.5,{r:e+=(o.r-128)/128*l*.5,g:t+=(o.g-128)/128*l*.5,b:n+=(o.b-128)/128*l*.5}}var I=50;function C(){console.log("Image upload button clicked"),window.electronAPI&&"function"==typeof window.electronAPI.openFileDialog?window.electronAPI.openFileDialog({properties:["openFile"],filters:[{name:"Images",extensions:["jpg","jpeg","png","bmp"]}]}).then((function(e){e&&(console.log("Selected image:",e),Z.originalImageElement.src="file://".concat(e))})).catch((function(e){console.error("Error in Electron file dialog:",e),B()})):(console.log("Using browser file input"),B())}function B(){var e=document.createElement("input");e.type="file",e.accept="image/*",e.addEventListener("change",(function(e){if(this.files&&this.files[0]){var t=this.files[0];console.log("Selected file:",t.name);var n=new FileReader;n.onload=function(e){Z.originalImageElement.src=e.target.result},n.readAsDataURL(t)}})),e.click()}function P(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.getElementById("view-split"),r=document.getElementById("view-before"),o=document.getElementById("view-after"),a=document.getElementById("original-image-container"),i=document.getElementById("comparison-slider"),c=document.getElementById("vertical-divider");switch(n.classList.remove("active"),r.classList.remove("active"),o.classList.remove("active"),e){case"split":n.classList.add("active"),t&&(I=50),a.style.clipPath="inset(0 ".concat(100-I,"% 0 0)"),c.style.left="".concat(I,"%"),i.style.left="".concat(I,"%"),i.style.display="block",a.style.display="block",c.style.display="block";break;case"before":r.classList.add("active"),a.style.clipPath="inset(0 0 0 0)",i.style.display="none",c.style.display="none",a.style.display="block";break;case"after":o.classList.add("active"),a.style.display="none",i.style.display="none",c.style.display="none"}}function M(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var S={custom:{contrast:1.2,saturation:1.15,redBalance:1.05,greenBalance:.95,blueBalance:1.1,shadowsShift:[.05,0,-.05],highlightsShift:[.03,.03,0]},warm:{contrast:1.1,saturation:.9,redBalance:1.15,greenBalance:.95,blueBalance:.85,shadowsShift:[.08,.02,-.05],highlightsShift:[.05,0,-.05]},cool:{contrast:1.3,saturation:.85,redBalance:.9,greenBalance:1,blueBalance:1.2,shadowsShift:[-.03,0,.08],highlightsShift:[0,0,.03]},bw:{contrast:1.5,saturation:0,redBalance:.33,greenBalance:.33,blueBalance:.33,shadowsShift:[-.05,-.05,-.05],highlightsShift:[.05,.05,.05]},film:{contrast:.9,saturation:.8,redBalance:1.1,greenBalance:1.05,blueBalance:.9,shadowsShift:[.1,.05,0],highlightsShift:[-.02,-.02,.05]}},O={};function T(e,t){var n=document.getElementById(e),r=document.getElementById("".concat(e,"-value"));n&&(n.value=t),r&&(r.textContent=t.toFixed(2))}function A(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.getElementById("lut-preview");if(t){var n="# LUT Preview will be generated here";window.generateCubeLUT&&(n=window.generateCubeLUT()),t.textContent=e?n:n.slice(0,500)+"..."}else console.warn("LUT preview element not found")}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;console.log("Toast notification: ".concat(e," (").concat(t,")"));var r=document.querySelector(".toast-container");r||((r=document.createElement("div")).className="toast-container",document.body.appendChild(r));var o=document.createElement("div");return o.className="toast toast-".concat(t),o.textContent=e,r.appendChild(o),setTimeout((function(){o.classList.add("show")}),10),setTimeout((function(){o.classList.remove("show"),setTimeout((function(){r.removeChild(o)}),300)}),n),o}function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function F(){F=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof p?t:p,i=Object.create(a.prototype),c=new S(r||[]);return o(i,"_invoke",{value:B(e,n,c)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var h="suspendedStart",g="suspendedYield",m="executing",f="completed",v={};function p(){}function y(){}function b(){}var w={};s(w,i,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(O([])));L&&L!==n&&r.call(L,i)&&(w=L);var E=b.prototype=p.prototype=Object.create(w);function I(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,a,i,c){var l=d(e[o],e,a);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==N(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(u).then((function(e){s.value=e,i(s)}),(function(e){return n("throw",e,i,c)}))}c(l.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function B(t,n,r){var o=h;return function(a,i){if(o===m)throw Error("Generator is already running");if(o===f){if("throw"===a)throw i;return{value:e,done:!0}}for(r.method=a,r.arg=i;;){var c=r.delegate;if(c){var l=P(c,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var s=d(t,n,r);if("normal"===s.type){if(o=r.done?f:g,s.arg===v)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=f,r.method="throw",r.arg=s.arg)}}}function P(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,P(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=d(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,v;var i=a.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(N(t)+" is not iterable")}return y.prototype=b,o(E,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=s(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s(e,l,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},I(C.prototype),s(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new C(u(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},I(E),s(E,l,"Generator"),s(E,i,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return c.type="throw",c.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function U(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function _(e){return z.apply(this,arguments)}function z(){return e=F().mark((function e(t){var n,r,o,a,i,c,l=arguments;return F().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:"lut.cube",console.log("Saving LUT file"),e.prev=2,r=n.endsWith(".cube")?n:"".concat(n,".cube"),!window.electronAPI||"function"!=typeof window.electronAPI.saveLut){e.next=13;break}return e.next=7,window.electronAPI.saveLut({content:t,defaultPath:r});case 7:if(!(o=e.sent)){e.next=11;break}return j("LUT saved to: ".concat(o),"success"),e.abrupt("return",o);case 11:e.next=24;break;case 13:return a=new Blob([t],{type:"text/plain"}),i=URL.createObjectURL(a),(c=document.createElement("a")).href=i,c.download=r,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(i),j("LUT downloaded as ".concat(r),"success"),e.abrupt("return",r);case 24:e.next=31;break;case 26:return e.prev=26,e.t0=e.catch(2),console.error("Error saving LUT:",e.t0),j("Failed to save LUT file","error"),e.abrupt("return",null);case 31:case"end":return e.stop()}}),e,null,[[2,26]])})),z=function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){U(a,r,o,i,c,"next",e)}function c(e){U(a,r,o,i,c,"throw",e)}i(void 0)}))},z.apply(this,arguments);var e}function D(){var e=Z.currentLutParams,t=e.size||32,n="";n+="# ".concat(e.title,"\n"),n+="# Generated by LOTS App\n\n",n+="LUT_3D_SIZE ".concat(t,"\n"),n+="DOMAIN_MIN 0.0 0.0 0.0\n",n+="DOMAIN_MAX 1.0 1.0 1.0\n\n";for(var r=1/(t-1),o=0;o<t;o++)for(var a=0;a<t;a++)for(var i=0;i<t;i++){var c=i*r,l=a*r,s=o*r;if("basic"===Z.activeMode){var u=H(c,l,s);c=u.r,l=u.g,s=u.b}else{var d=W(c,l,s);c=d.r,l=d.g,s=d.b}c=Math.min(1,Math.max(0,c)),l=Math.min(1,Math.max(0,l)),s=Math.min(1,Math.max(0,s)),n+="".concat(c.toFixed(6)," ").concat(l.toFixed(6)," ").concat(s.toFixed(6),"\n")}return n}function H(e,t,n){var r=Z.currentLutParams.basic||{};if(e=v(e,r.contrast||1),t=v(t,r.contrast||1),n=v(n,r.contrast||1),e*=r.redBalance||1,t*=r.greenBalance||1,n*=r.blueBalance||1,r.shadowsShift&&r.highlightsShift){var o=Math.pow(1-Math.max(e,Math.max(t,n)),2),a=Math.pow(Math.max(e,Math.max(t,n)),2);e+=r.shadowsShift[0]*o+r.highlightsShift[0]*a,t+=r.shadowsShift[1]*o+r.highlightsShift[1]*a,n+=r.shadowsShift[2]*o+r.highlightsShift[2]*a}if(void 0!==r.saturation&&1!==r.saturation){var i=.2126*e+.7152*t+.0722*n;e=i+r.saturation*(e-i),t=i+r.saturation*(t-i),n=i+r.saturation*(n-i)}return{r:e,g:t,b:n}}function W(e,t,n){var r=Z.currentLutParams;if(r.lumetri&&(0!==r.lumetri.temperature||0!==r.lumetri.tint)){var o=function(e,t,n,r,o){return(r<0||r>0)&&(e*=1-.4*r,t*=1-.2*r,n*=1+.6*r),(o>0||o<0)&&(e*=1+.3*o,t*=1-.3*o,n*=1+.3*o),{r:e,g:t,b:n}}(e,t,n,r.lumetri.temperature/150,r.lumetri.tint/150);e=o.r,t=o.g,n=o.b}if(r.lumetri){if(0!==r.lumetri.exposure){var a=Math.pow(2,r.lumetri.exposure);e*=a,t*=a,n*=a}if(0!==r.lumetri.contrast){var i=1+r.lumetri.contrast/150*1.5;e=v(e,i),t=v(t,i),n=v(n,i)}}if(r.lumetri){var c=function(e,t,n,r,o,a,i){var c=.2126*e+.7152*t+.0722*n,l=Math.pow(c,2)*r+Math.pow(1-c,2)*o+Math.pow(c,4)*a+Math.pow(1-c,4)*i;return{r:e+=l,g:t+=l,b:n+=l}}(e,t,n,r.lumetri.highlights/150*1.5,r.lumetri.shadows/150*1.5,r.lumetri.whites/150*1.5,r.lumetri.blacks/150*1.5);e=c.r,t=c.g,n=c.b}if(r.colorWheels){var u=r.colorWheels.shadowTint,d=r.colorWheels.highlightTint,h=r.colorWheels.tintBalance/150;if(128!==u.r||128!==u.g||128!==u.b||128!==d.r||128!==d.g||128!==d.b||0!==h){var g=E(e,t,n,u,d,h);e=g.r,t=g.g,n=g.b}}if(r.curves){var m=r.curves.rgb;m&&(e=s(m,e),t=s(m,t),n=s(m,n)),r.curves.red&&!l(r.curves.red)&&(e=s(r.curves.red,e)),r.curves.green&&!l(r.curves.green)&&(t=s(r.curves.green,t)),r.curves.blue&&!l(r.curves.blue)&&(n=s(r.curves.blue,n))}if(r.creative){if(0!==r.creative.vibrance){var f=r.creative.vibrance/150,p=.2126*e+.7152*t+.0722*n,y=Math.max(e,t,n),w=Math.min(e,t,n),x=f*(1-(0===y?0:(y-w)/y));e=p+(e-p)*(1+x),t=p+(t-p)*(1+x),n=p+(n-p)*(1+x)}if(r.creative.fadedFilm>0){var L=b(e,t,n,r.creative.fadedFilm/100);e=L.r,t=L.g,n=L.b}}return{r:e,g:t,b:n}}function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function G(){G=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof p?t:p,i=Object.create(a.prototype),c=new S(r||[]);return o(i,"_invoke",{value:B(e,n,c)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var h="suspendedStart",g="suspendedYield",m="executing",f="completed",v={};function p(){}function y(){}function b(){}var w={};s(w,i,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(O([])));L&&L!==n&&r.call(L,i)&&(w=L);var E=b.prototype=p.prototype=Object.create(w);function I(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,a,i,c){var l=d(e[o],e,a);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==R(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(u).then((function(e){s.value=e,i(s)}),(function(e){return n("throw",e,i,c)}))}c(l.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function B(t,n,r){var o=h;return function(a,i){if(o===m)throw Error("Generator is already running");if(o===f){if("throw"===a)throw i;return{value:e,done:!0}}for(r.method=a,r.arg=i;;){var c=r.delegate;if(c){var l=P(c,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var s=d(t,n,r);if("normal"===s.type){if(o=r.done?f:g,s.arg===v)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=f,r.method="throw",r.arg=s.arg)}}}function P(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,P(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=d(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,v;var i=a.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(R(t)+" is not iterable")}return y.prototype=b,o(E,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=s(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s(e,l,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},I(C.prototype),s(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new C(u(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},I(E),s(E,l,"Generator"),s(E,i,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return c.type="throw",c.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function q(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function X(){return V.apply(this,arguments)}function V(){return(e=G().mark((function e(){var t,n;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Exporting LUT"),e.prev=1,t=D(),n=J(Z.currentLutParams.title),e.next=6,_(t,n);case 6:e.sent?console.log("LUT exported successfully"):console.warn("LUT export was cancelled or failed"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Error exporting LUT:",e.t0),j("Failed to export LUT: "+e.t0.message,"error");case 14:case"end":return e.stop()}}),e,null,[[1,10]])})),V=function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){q(a,r,o,i,c,"next",e)}function c(e){q(a,r,o,i,c,"throw",e)}i(void 0)}))}).apply(this,arguments);var e}function J(e){if(!e)return"lut.cube";var t=e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_-]/g,"").toLowerCase();return t.endsWith(".cube")||(t+=".cube"),t}function Y(e){return console.log("Processing image in ".concat(Z.activeMode," mode")),"basic"===Z.activeMode?function(e){if(console.log("Processing image with basic adjustments"),!e)return console.error("No image to process"),null;try{var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.naturalWidth,t.height=e.naturalHeight,n.drawImage(e,0,0);var r=n.getImageData(0,0,t.width,t.height);return f(r),n.putImageData(r,0,0),t.toDataURL("image/jpeg",1)}catch(e){return console.error("Error processing image:",e),null}}(e):function(e){if(console.log("Processing image with advanced adjustments"),console.log("Advanced parameters:",JSON.stringify(Z.currentLutParams.lumetri,null,2)),!e)return console.error("No image to process"),null;try{var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.naturalWidth,t.height=e.naturalHeight,n.drawImage(e,0,0);var r=n.getImageData(0,0,t.width,t.height);return console.log("Applying advanced adjustments in sequence"),console.log("1. Applying basic corrections"),f(r),console.log("2. Applying Lumetri adjustments"),function(e){if(!Z.currentLutParams.lumetri)return console.warn("No Lumetri parameters available"),e;var t=Z.currentLutParams.lumetri,n=e.data;console.log("Applying Lumetri adjustments with params:","exposure: ".concat(t.exposure,", "),"contrast: ".concat(t.contrast,", "),"highlights: ".concat(t.highlights,", "),"shadows: ".concat(t.shadows,", "),"whites: ".concat(t.whites,", "),"blacks: ".concat(t.blacks,", "),"temperature: ".concat(t.temperature,", "),"tint: ".concat(t.tint));for(var r=0;r<n.length;r+=4){var o=n[r]/255,a=n[r+1]/255,i=n[r+2]/255;if(0!==t.exposure){var c=Math.pow(2,t.exposure/2);o*=c,a*=c,i*=c}if(0!==t.contrast){var l=1+t.contrast/100,s=.5;o=s+(o-s)*l,a=s+(a-s)*l,i=s+(i-s)*l}var u=.2126*o+.7152*a+.0722*i;if(0!==t.highlights){var d=Math.pow(u,2),h=t.highlights/100*.5;o+=h*d,a+=h*d,i+=h*d}if(0!==t.shadows){var g=Math.pow(1-u,2),m=t.shadows/100*.5;o+=m*g,a+=m*g,i+=m*g}if(0!==t.whites){var f=Math.pow(u,4),v=t.whites/100*.5;o+=v*f,a+=v*f,i+=v*f}if(0!==t.blacks){var p=Math.pow(1-u,4),y=t.blacks/100*.5;o+=y*p,a+=y*p,i+=y*p}if(0!==t.temperature||0!==t.tint){var b=t.temperature/100;o*=1-.2*b,a*=1-.1*b,i*=1+.3*b;var w=t.tint/100;o*=1+.1*w,a*=1-.1*w,i*=1+.1*w}o=Math.min(1,Math.max(0,o)),a=Math.min(1,Math.max(0,a)),i=Math.min(1,Math.max(0,i)),n[r]=Math.round(255*o),n[r+1]=Math.round(255*a),n[r+2]=Math.round(255*i)}}(r),console.log("3. Applying color wheels adjustments"),function(e){for(var t=Z.currentLutParams.colorWheels,n=e.data,r=0;r<n.length;r+=4){var o=E(n[r]/255,n[r+1]/255,n[r+2]/255,t.shadowTint,t.highlightTint,t.tintBalance/150);n[r]=Math.round(255*Math.min(1,Math.max(0,o.r))),n[r+1]=Math.round(255*Math.min(1,Math.max(0,o.g))),n[r+2]=Math.round(255*Math.min(1,Math.max(0,o.b)))}}(r),console.log("4. Applying creative effects"),function(e){for(var t=Z.currentLutParams.creative,n=e.data,r=0;r<n.length;r+=4){var o=n[r]/255,a=n[r+1]/255,i=n[r+2]/255;if(0!==t.vibrance){var c=y(o,a,i,t.vibrance/150);o=c.r,a=c.g,i=c.b}if(t.fadedFilm>0){var l=b(o,a,i,t.fadedFilm/100);o=l.r,a=l.g,i=l.b}o=Math.min(1,Math.max(0,o)),a=Math.min(1,Math.max(0,a)),i=Math.min(1,Math.max(0,i)),n[r]=Math.round(255*o),n[r+1]=Math.round(255*a),n[r+2]=Math.round(255*i)}}(r),console.log("5. Applying curves adjustments"),Z.curvesPanel?function(e){d&&d.applyCurvesToImage(e)}(r):console.warn("Curves panel not available, skipping curves adjustments"),n.putImageData(r,0,0),console.log("Advanced processing complete"),t.toDataURL("image/jpeg",1)}catch(e){return console.error("Error processing advanced image:",e),null}}(e)}var Z={activeMode:"basic",originalImage:null,processedImage:null,currentLutParams:{size:32,title:"Signature Look",contrast:1.2,saturation:1.15,redBalance:1.05,greenBalance:.95,blueBalance:1.1,shadowsShift:[.05,0,-.05],highlightsShift:[.03,.03,0],lumetri:{exposure:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,temperature:0,tint:0}}};function $(){if(Z.originalImage){console.log("Applying image adjustments in ".concat(Z.activeMode," mode"));try{var e=Y(Z.originalImageElement);e&&Z.processedImageElement?(Z.processedImageElement.src=e,console.log("Processed image updated")):console.warn("Failed to update processed image")}catch(e){console.error("Error processing image:",e)}}else console.warn("No original image to process")}document.addEventListener("DOMContentLoaded",(function(){!function(){var e;function t(){[{toggle:"basic-correction-toggle",content:"basic-correction-section"},{toggle:"creative-toggle",content:"creative-section"},{toggle:"color-wheels-toggle",content:"color-wheels-section"},{toggle:"curves-toggle",content:"curves-section"}].forEach((function(e){var t=function(e){var t=document.getElementById(e);if(!t)return null;var n=t.cloneNode(!0);return t.parentNode.replaceChild(n,t),n}(e.toggle),n=document.getElementById(e.content);t&&n?(t.classList.contains("expanded")?(n.style.display="block",n.style.maxHeight="1000px",n.style.opacity="1"):(n.style.display="none",n.style.maxHeight="0",n.style.opacity="0"),t.addEventListener("click",(function(){var t=this;console.log("FIXED handler - Toggle clicked: ".concat(e.toggle)),this.classList.toggle("expanded"),this.classList.contains("expanded")?(n.style.display="block",n.offsetHeight,n.style.maxHeight="1000px",n.style.opacity="1"):(n.style.maxHeight="0",n.style.opacity="0",setTimeout((function(){t.classList.contains("expanded")||(n.style.display="none")}),300))})),console.log("Fixed toggle handler for: ".concat(e.toggle))):console.error("Cannot fix section - missing elements: ".concat(e.toggle," or ").concat(e.content))})),console.log("All section toggles have been fixed with direct style manipulation")}document.querySelectorAll(".lumetri-section h3").forEach((function(e){var t=e.cloneNode(!0);e.parentNode.replaceChild(t,e);var n=t.nextElementSibling;n&&n.classList.contains("section-content")?t.addEventListener("click",(function(){console.log("Toggle clicked for: ".concat(t.id," (centralized handler)")),t.classList.toggle("expanded"),n.classList.toggle("expanded"),n.offsetHeight})):console.error("Missing content section for toggle:",t.id)})),setTimeout((function(){console.log("======= DEBUG SECTIONS ======="),[{toggle:"basic-correction-toggle",content:"basic-correction-section"},{toggle:"creative-toggle",content:"creative-section"},{toggle:"color-wheels-toggle",content:"color-wheels-section"},{toggle:"curves-toggle",content:"curves-section"}].forEach((function(e){var t=document.getElementById(e.toggle),n=document.getElementById(e.content);console.log("Toggle [".concat(e.toggle,"]: ").concat(t?"Found":"NOT FOUND")),console.log("Content [".concat(e.content,"]: ").concat(n?"Found":"NOT FOUND")),t&&n&&(console.log("- Toggle has 'expanded' class: ".concat(t.classList.contains("expanded"))),console.log("- Content has 'expanded' class: ".concat(n.classList.contains("expanded"))),console.log("- Content style.maxHeight: ".concat(n.style.maxHeight)),console.log("- Content offsetHeight: ".concat(n.offsetHeight,"px")),console.log("- Content computedStyle.maxHeight: ".concat(window.getComputedStyle(n).maxHeight)),console.log("- Content style.display: ".concat(window.getComputedStyle(n).display)))})),console.log("============================")}),1e3),document.addEventListener("DOMContentLoaded",(function(){setTimeout(t,500)})),(e=document.createElement("style")).textContent='\n    /* Override styles to fix section toggling */\n    .section-content {\n      transition: max-height 0.3s ease, opacity 0.3s ease;\n    }\n    \n    .lumetri-section h3.expanded + .section-content {\n      display: block !important;\n      max-height: 1000px !important;\n      opacity: 1 !important;\n      overflow: visible !important;\n    }\n    \n    .lumetri-section h3:not(.expanded) + .section-content {\n      max-height: 0 !important;\n      opacity: 0 !important;\n      overflow: hidden !important;\n    }\n    \n    /* Add a visual indicator for debug purposes */\n    .lumetri-section h3::after {\n      content: " ▼";\n      transition: transform 0.3s ease;\n    }\n    \n    .lumetri-section h3.expanded::after {\n      transform: rotate(180deg);\n    }\n  ',document.head.appendChild(e),console.log("Override styles added to fix section toggling"),setTimeout((function(){var e=document.createElement("div");e.style.position="fixed",e.style.bottom="10px",e.style.right="10px",e.style.zIndex="9999",e.style.background="rgba(0,0,0,0.7)",e.style.padding="5px",e.style.borderRadius="5px",[{toggle:"basic-correction-toggle",content:"basic-correction-section",label:"Basic"},{toggle:"creative-toggle",content:"creative-section",label:"Creative"},{toggle:"color-wheels-toggle",content:"color-wheels-section",label:"Color Wheels"},{toggle:"curves-toggle",content:"curves-section",label:"Curves"}].forEach((function(t){var n=document.createElement("button");n.textContent="Toggle ".concat(t.label),n.style.margin="5px",n.style.padding="5px 10px",n.addEventListener("click",(function(){var e=document.getElementById(t.toggle),r=document.getElementById(t.content);e&&r?(e.classList.toggle("expanded"),"none"===r.style.display||"0px"===r.style.maxHeight?(r.style.display="block",r.style.maxHeight="1000px",r.style.opacity="1",n.style.background="#4CAF50"):(r.style.maxHeight="0px",r.style.opacity="0",r.style.display="none",n.style.background=""),console.log("Emergency toggle for ".concat(t.label,": ").concat(e.classList.contains("expanded")))):console.error("Emergency toggle failed - couldn't find elements for ".concat(t.label))})),e.appendChild(n)})),document.body.appendChild(e),console.log("Emergency toggle buttons added")}),1e3),console.log("All section toggles set up in centralized function")}()})),window.applyImageAdjustments=$,document.addEventListener("DOMContentLoaded",(function(){var e,t,n,r,o,a,i;console.log("LOTS App initializing..."),window.appState=Z,console.log("Initializing UI Elements"),function(){console.log("Setting up modal dialogs");var e=document.getElementById("view-code-btn"),t=document.getElementById("view-code-btn-advanced"),n=document.getElementById("code-modal"),r=document.getElementById("close-modal-btn");e||console.warn("View code button not found"),t||console.warn("Advanced view code button not found"),n||console.warn("Code modal not found"),r||console.warn("Close modal button not found"),e&&n&&e.addEventListener("click",(function(){A(!0),n.style.display="block"})),t&&n&&t.addEventListener("click",(function(){A(!0),n.style.display="block"})),r&&r.addEventListener("click",(function(){document.querySelectorAll(".modal").forEach((function(e){e.style.display="none"}))})),window.addEventListener("click",(function(e){document.querySelectorAll(".modal").forEach((function(t){e.target===t&&(t.style.display="none")}))}))}(),console.log("Initializing expandable sections"),[{toggle:"basic-correction-toggle",content:"basic-correction-section",expanded:!0},{toggle:"creative-toggle",content:"creative-section",expanded:!1},{toggle:"color-wheels-toggle",content:"color-wheels-section",expanded:!1},{toggle:"curves-toggle",content:"curves-section",expanded:!1}].forEach((function(e){var t=document.getElementById(e.toggle),n=document.getElementById(e.content);t?n?(console.log("Setting up section: ".concat(e.toggle," (expanded: ").concat(e.expanded,")")),e.expanded?(t.classList.add("expanded"),n.classList.add("expanded"),n.style.display="block",n.style.maxHeight="none"):(t.classList.remove("expanded"),n.classList.remove("expanded"),n.style.display="none",n.style.maxHeight="0"),t.addEventListener("click",(function(){console.log("Toggle clicked for: ".concat(e.toggle));var r=!t.classList.contains("expanded");t.classList.toggle("expanded"),r?(n.style.display="block",setTimeout((function(){n.classList.add("expanded"),n.style.maxHeight="none"}),10),console.log("Expanding section: ".concat(e.content))):(n.classList.remove("expanded"),n.style.maxHeight="0",setTimeout((function(){n.style.display="none"}),300),console.log("Collapsing section: ".concat(e.content)))}))):console.error("Content element not found: #".concat(e.content)):console.error("Toggle element not found: #".concat(e.toggle))})),o=document.getElementById("minimize-btn"),a=document.getElementById("maximize-btn"),i=document.getElementById("close-btn"),o&&o.addEventListener("click",(function(){window.electronAPI&&window.electronAPI.windowControl("minimize")})),a&&a.addEventListener("click",(function(){window.electronAPI&&window.electronAPI.windowControl("maximize")})),i&&i.addEventListener("click",(function(){window.electronAPI&&window.electronAPI.windowControl("close")})),console.log("UI Elements initialization complete"),console.log("Initializing Basic Corrections"),Z.currentLutParams.basic||(Z.currentLutParams.basic={contrast:1.2,saturation:1.15,redBalance:1.05,greenBalance:.95,blueBalance:1.1}),Z.currentLutParams.lumetri||(Z.currentLutParams.lumetri={exposure:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,temperature:0,tint:0}),function(){console.log("Setting up basic controls");var e=document.getElementById("contrast"),t=document.getElementById("saturation"),n=document.getElementById("red-balance"),r=document.getElementById("green-balance"),o=document.getElementById("blue-balance"),a=document.getElementById("contrast-value"),i=document.getElementById("saturation-value"),c=document.getElementById("red-balance-value"),l=document.getElementById("green-balance-value"),s=document.getElementById("blue-balance-value");e||console.warn("Contrast slider not found"),t||console.warn("Saturation slider not found"),n||console.warn("Red balance slider not found"),r||console.warn("Green balance slider not found"),o||console.warn("Blue balance slider not found"),m(e,a,"contrast"),m(t,i,"saturation"),m(n,c,"redBalance"),m(r,l,"greenBalance"),m(o,s,"blueBalance"),console.log("Basic controls setup complete")}(),function(){console.log("Initializing title and LUT size controls");var e=document.getElementById("title"),t=document.getElementById("lut-size");e||console.warn("Title input not found"),t||console.warn("LUT size select not found"),e&&(e.value=Z.currentLutParams.title||"Signature Look",e.addEventListener("input",(function(){Z.currentLutParams.title=e.value}))),t&&(t.value=Z.currentLutParams.size||"32",t.addEventListener("change",(function(){Z.currentLutParams.size=parseInt(t.value)})))}(),console.log("Basic Corrections initialized successfully"),function(){console.log("Initializing Creative Effects"),Z.currentLutParams.creative||(Z.currentLutParams.creative={fadedFilm:0,vibrance:0});var e,t,n=document.getElementById("faded-film"),r=document.getElementById("vibrance"),o=document.getElementById("faded-film-value"),a=document.getElementById("vibrance-value");p(n,o,"fadedFilm"),p(r,a,"vibrance"),e=document.getElementById("creative-toggle"),t=document.getElementById("creative-section"),e&&t&&e.addEventListener("click",(function(){e.classList.toggle("expanded"),t.classList.toggle("expanded")}))}(),function(){console.log("Initializing Color Wheels"),Z.currentLutParams.colorWheels||(Z.currentLutParams.colorWheels={shadowTint:{r:128,g:128,b:128},highlightTint:{r:128,g:128,b:128},tintBalance:0});var e=document.getElementById("shadow-color-wheel"),t=document.getElementById("highlight-color-wheel"),n=document.getElementById("tint-balance"),r=document.getElementById("tint-balance-value");e&&w(e,"shadowTint"),t&&w(t,"highlightTint"),n&&r&&(n.value=Z.currentLutParams.colorWheels.tintBalance,r.textContent=Z.currentLutParams.colorWheels.tintBalance.toFixed(1),n.addEventListener("input",(function(){Z.currentLutParams.colorWheels.tintBalance=parseFloat(n.value),r.textContent=Z.currentLutParams.colorWheels.tintBalance.toFixed(1),$()})));var o,a,i=document.querySelector('.reset-btn[data-section="colorWheels"]');i&&i.addEventListener("click",x),o=document.getElementById("color-wheels-toggle"),a=document.getElementById("color-wheels-section"),o&&a&&o.addEventListener("click",(function(){o.classList.toggle("expanded"),a.classList.toggle("expanded")}))}(),console.log("Setting up Curves Panel"),Z.currentLutParams.curves||(Z.currentLutParams.curves=JSON.parse(JSON.stringify(c))),d=new u(Z.currentLutParams.curves),n=document.getElementById("curves-toggle"),r=document.getElementById("curves-section"),n&&r&&n.addEventListener("click",(function(){n.classList.toggle("expanded"),r.classList.toggle("expanded")})),"complete"===document.readyState||"interactive"===document.readyState?setTimeout((function(){return d.init()}),0):document.addEventListener("DOMContentLoaded",(function(){return d.init()})),Z.curvesPanel=d,console.log("Initializing Image Comparison"),function(){console.log("Initializing Preview Controller");var e,t,n,r=document.getElementById("original-image"),o=document.getElementById("processed-image"),a=document.getElementById("original-placeholder"),i=document.getElementById("comparison-container"),c=document.getElementById("image-upload-btn");Z.originalImageElement=r,Z.processedImageElement=o,e=document.getElementById("view-split"),t=document.getElementById("view-before"),n=document.getElementById("view-after"),e&&e.addEventListener("click",(function(){P("split")})),t&&t.addEventListener("click",(function(){P("before")})),n&&n.addEventListener("click",(function(){P("after")})),c&&c.addEventListener("click",C),r&&(r.onload=function(){console.log("Image loaded successfully"),Z.originalImage=r,Z.processedImage=o,a&&(a.style.display="none"),i&&(i.style.display="block"),function(){var e=document.getElementById("comparison-container"),t=document.getElementById("original-image-container"),n=document.getElementById("comparison-slider"),r=document.getElementById("vertical-divider"),o=!1,a=0,i=50;function c(e){e=Math.max(0,Math.min(100,e)),I=e,t.style.clipPath="inset(0 ".concat(100-e,"% 0 0)"),n.style.left=e+"%",r.style.left=e+"%"}n.addEventListener("mousedown",(function(e){o=!0,a=e.clientX;var t=parseFloat(n.style.left)||I;i=t,e.preventDefault()})),document.addEventListener("mousemove",(function(t){if(o){var n=e.getBoundingClientRect(),r=(t.clientX-a)/n.width*100;c(i+r),t.preventDefault()}})),document.addEventListener("mouseup",(function(){o=!1})),n.addEventListener("touchstart",(function(e){o=!0,a=e.touches[0].clientX;var t=parseFloat(n.style.left)||I;i=t,e.preventDefault()})),document.addEventListener("touchmove",(function(t){if(o){var n=e.getBoundingClientRect(),r=(t.touches[0].clientX-a)/n.width*100;c(i+r),t.preventDefault()}})),document.addEventListener("touchend",(function(){o=!1})),e.addEventListener("click",(function(t){if(!t.target.closest(".toggle-view")&&!t.target.closest(".slider-handle")){var n=e.getBoundingClientRect();c((t.clientX-n.left)/n.width*100)}})),c(I)}(),$()})}(),function(){console.log("Initializing Presets");var e=document.querySelectorAll(".preset-btn");e.forEach((function(t){t.addEventListener("click",(function(){var n,r,o,a;e.forEach((function(e){return e.classList.remove("active")})),t.classList.add("active"),n=t.id.split("-")[1],(a=S[n]||O[n])?(console.log("Applying preset: ".concat(n)),Z.activePresetId=n,Z.currentLutParams.basic||(Z.currentLutParams.basic={}),Z.currentLutParams.basic.contrast=a.contrast,Z.currentLutParams.basic.saturation=a.saturation,Z.currentLutParams.basic.redBalance=a.redBalance,Z.currentLutParams.basic.greenBalance=a.greenBalance,Z.currentLutParams.basic.blueBalance=a.blueBalance,a.shadowsShift&&(Z.currentLutParams.basic.shadowsShift=M(a.shadowsShift)),a.highlightsShift&&(Z.currentLutParams.basic.highlightsShift=M(a.highlightsShift)),a.advanced&&(void 0!==(r=a.advanced).temperature&&Z.currentLutParams.lumetri&&(Z.currentLutParams.lumetri.temperature=r.temperature),void 0!==r.tint&&Z.currentLutParams.lumetri&&(Z.currentLutParams.lumetri.tint=r.tint)),T("contrast",(o=Z.currentLutParams.basic).contrast),T("saturation",o.saturation),T("red-balance",o.redBalance),T("green-balance",o.greenBalance),T("blue-balance",o.blueBalance),$()):console.warn("Preset '".concat(n,"' not found"))}))})),function(){try{var e=localStorage.getItem("lotsAppUserPresets");e&&(O=JSON.parse(e),console.log("Loaded user presets:",Object.keys(O)))}catch(e){console.error("Failed to load user presets:",e)}}()}(),console.log("Initializing File Service"),console.log("Initializing LUT Generator Service"),window.generateCubeLUT=D,console.log("Initializing Export Service"),e=document.getElementById("save-lut-btn"),t=document.getElementById("save-lut-btn-advanced"),e&&e.addEventListener("click",X),t&&t.addEventListener("click",X),function(){console.log("Setting up mode toggle...");var e=document.getElementById("mode-toggle"),t=document.getElementById("basic-controls"),n=document.getElementById("advanced-controls");e?t?n?(console.log("Mode toggle elements found, adding event listener..."),e.addEventListener("change",(function(){var e=this.checked;if(console.log("Mode toggle changed. Advanced mode: ".concat(e)),Z.activeMode=e?"advanced":"basic",console.log("Switching to ".concat(Z.activeMode," mode")),console.log("Basic controls display: ".concat(e?"none":"block")),console.log("Advanced controls display: ".concat(e?"block":"none")),t.style.display=e?"none":"block",n.style.display=e?"block":"none",e)try{console.log("Setting up advanced controls..."),function(){console.log("Setting up advanced mode controls...");var e=document.getElementById("advanced-controls");if(e){var t=e.querySelector(".lumetri-section");t||((t=document.createElement("div")).className="lumetri-section",e.appendChild(t));var n=document.getElementById("basic-correction-toggle"),r=document.getElementById("basic-correction-section");n||((n=document.createElement("h3")).id="basic-correction-toggle",n.className="expanded",n.textContent="Basic Correction",t.appendChild(n)),r||((r=document.createElement("div")).id="basic-correction-section",r.className="section-content expanded",t.appendChild(r)),r.innerHTML="",n.classList.add("expanded"),r.classList.add("expanded"),r.style.display="block",r.style.maxHeight="1000px",n.onclick=function(){console.log("Basic correction toggle clicked"),this.classList.toggle("expanded"),this.classList.contains("expanded")?(r.classList.add("expanded"),r.style.display="block",setTimeout((function(){r.style.maxHeight="1000px"}),10)):(r.classList.remove("expanded"),r.style.maxHeight="0",setTimeout((function(){r.style.display="none"}),300))},console.log("Creating advanced sliders..."),h(r,{id:"exposure-advanced",label:"Exposure",min:-5,max:5,step:.1,initialValue:Z.currentLutParams.lumetri.exposure||0,paramName:"exposure"}),h(r,{id:"contrast-advanced",label:"Contrast",min:-100,max:100,step:1,initialValue:Z.currentLutParams.lumetri.contrast||0,paramName:"contrast"}),h(r,{id:"highlights-advanced",label:"Highlights",min:-100,max:100,step:1,initialValue:Z.currentLutParams.lumetri.highlights||0,paramName:"highlights"}),h(r,{id:"shadows-advanced",label:"Shadows",min:-100,max:100,step:1,initialValue:Z.currentLutParams.lumetri.shadows||0,paramName:"shadows"}),h(r,{id:"whites-advanced",label:"Whites",min:-100,max:100,step:1,initialValue:Z.currentLutParams.lumetri.whites||0,paramName:"whites"}),h(r,{id:"blacks-advanced",label:"Blacks",min:-100,max:100,step:1,initialValue:Z.currentLutParams.lumetri.blacks||0,paramName:"blacks"}),h(r,{id:"temperature-advanced",label:"Temperature",min:-100,max:100,step:1,initialValue:Z.currentLutParams.lumetri.temperature||0,paramName:"temperature"}),h(r,{id:"tint-advanced",label:"Tint",min:-100,max:100,step:1,initialValue:Z.currentLutParams.lumetri.tint||0,paramName:"tint"}),console.log("Adding reset button");var o=document.createElement("button");o.textContent="Reset",o.className="reset-btn",o.addEventListener("click",g),r.appendChild(o),console.log("Advanced controls setup complete")}else console.error("Advanced controls container not found!")}(),console.log("Advanced controls setup complete")}catch(e){console.error("Error setting up advanced controls:",e)}Z.originalImage&&Z.processedImage&&(console.log("Applying image adjustments after mode switch"),$())})),console.log("Mode toggle setup completed")):console.error("Advanced controls element not found!"):console.error("Basic controls element not found!"):console.error("Mode toggle element not found!")}(),function(){var e=document.getElementById("minimize-btn"),t=document.getElementById("maximize-btn"),n=document.getElementById("close-btn");e&&e.addEventListener("click",(function(){window.electronAPI&&window.electronAPI.windowControl("minimize")})),t&&t.addEventListener("click",(function(){window.electronAPI&&window.electronAPI.windowControl("maximize")})),n&&n.addEventListener("click",(function(){window.electronAPI&&window.electronAPI.windowControl("close")}))}(),console.log("LOTS App initialized successfully")}))})();
//# sourceMappingURL=bundle.js.map